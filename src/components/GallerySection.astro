---
const galleryGroups = [
  {
    direction: 'left',
    images: [
      {
        src: '/sri-janaki-mahal/IMG-20251017-WA0022.jpg',
        alt: 'Sri Janaki Mahal Trust Ayodhya - Traditional exterior view with golden lighting',
        caption: 'Sri Janaki Mahal Trust exterior illuminated for evening darshan seekers',
        title: 'Sri Janaki Mahal Trust Exterior',
        width: '1200',
        height: '800',
      },
      {
        src: '/sri-janaki-mahal/IMG-20251017-WA0028.jpg',
        alt: 'Serene courtyard of Janaki Mahal Trust near Ram Mandir',
        caption: 'Courtyard seating at Sri Janki Mahal Trust for peaceful meditation',
        title: 'Janaki Mahal Trust Courtyard',
        width: '1200',
        height: '800',
      },
      {
        src: '/sri-janaki-mahal/IMG-20251017-WA0034.jpg',
        alt: 'Ayodhya hotel corridor with devotional ambience at Sri Janki Mahal Trust',
        caption: 'Devotional corridor with bhajan ambience inside Sri Janaki Mahal Trust',
        title: 'Sri Janki Mahal Trust Corridor',
        width: '1200',
        height: '800',
      },
      {
        src: '/sri-janaki-mahal/IMG-20251017-WA0035.jpg',
        alt: 'Guest lounge area inside Sri Janaki Mahal Trust Ayodhya',
        caption: 'Comfortable lounge for devotees to relax after Ram Mandir darshan',
        title: 'Trust Lounge Area',
        width: '1200',
        height: '800',
      },
      {
        src: '/sri-janaki-mahal/IMG-20251017-WA0029.jpg',
        alt: 'Prayer-ready guest room at Janaki Mahal Trust',
        caption: 'Spacious room with prayer corner at Sri Janki Mahal Trust Ayodhya',
        title: 'Prayer Ready Guest Room',
        width: '1200',
        height: '800',
      },
      {
        src: '/sri-janaki-mahal/IMG-20251017-WA0031.jpg',
        alt: 'Dining hall at Sri Janaki Mahal Trust serving sattvik meals',
        caption: 'Sattvik dining hall serving complimentary meals for devotees',
        title: 'Sattvik Dining Hall',
        width: '1200',
        height: '800',
      },
    ],
  },
  {
    direction: 'right',
    images: [
      {
        src: '/sri-janaki-mahal/IMG-20251017-WA0032.jpg',
        alt: 'Peaceful meditation space at Shri Janki Mahal Trust Ayodhya',
        caption: 'Meditation space inside Sri Janaki Mahal Trust near Vasudev Ghat',
        title: 'Meditation Space',
        width: '1200',
        height: '800',
      },
      {
        src: '/sri-janaki-mahal/IMG-20251017-WA0030.jpg',
        alt: 'Ayodhya lodging near Ram Mandir with spacious interiors',
        caption: 'Spacious interiors welcoming pilgrims at Sri Janki Mahal Trust',
        title: 'Spacious Interiors',
        width: '1200',
        height: '800',
      },
      {
        src: '/sri-janaki-mahal/IMG-20251017-WA0033.jpg',
        alt: 'Sri Janaki Mahal Trust reception desk ready for check-in',
        caption: 'Reception at Janaki Mahal Trust assisting devotees day and night',
        title: 'Reception Desk',
        width: '1200',
        height: '800',
      },
      {
        src: '/sri-janaki-mahal/IMG-20251017-WA0023.jpg',
        alt: 'Sri Janki Mahal Trust courtyard pathway with greenery',
        caption: 'Green courtyard pathway leading to rooms at Sri Janaki Mahal Trust',
        title: 'Courtyard Pathway',
        width: '1200',
        height: '800',
      },
      {
        src: '/sri-janaki-mahal/IMG-20251017-WA0027.jpg',
        alt: 'Devotee friendly lobby at Sri Janaki Mahal Trust Ayodhya',
        caption: 'Lobby area designed for yatri groups waiting for check-in',
        title: 'Devotee Lobby',
        width: '1200',
        height: '800',
      },
      {
        src: '/sri-janaki-mahal/IMG-20251017-WA0034.jpg',
        alt: 'Temple style decor inside Sri Janaki Mahal Trust hotel',
        caption: 'Temple-inspired decor reminding devotees of Ram Mandir inside trust premises',
        title: 'Temple Style Decor',
        width: '1200',
        height: '800',
      },
    ],
  },
];

const AUTO_DURATION_SEC = 15;

const uniqueImageMap = new Map(
  galleryGroups
    .flatMap((group) => group.images)
    .map((image) => [
      image.src,
      {
        '@context': 'https://schema.org',
        '@type': 'ImageObject',
        contentUrl: `https://www.srijanakimahaltrustofficial.com${image.src}`,
        caption: image.caption,
        description: image.alt,
        name: image.title,
        creator: {
          '@type': 'Organization',
          name: 'Sri Janaki Mahal Trust',
        },
        copyrightHolder: {
          '@type': 'Organization',
          name: 'Sri Janaki Mahal Trust',
        },
        inLanguage: 'en',
        license: 'https://www.srijanakimahaltrustofficial.com',
        acquireLicensePage: 'https://www.srijanakimahaltrustofficial.com',
      },
    ])
);

const imageSchemas = Array.from(uniqueImageMap.values());
---

<section id="gallery" class="py-16 sm:py-24 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-12">
      <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 mb-4 text-balance">
        Sri Janaki Mahal Trust Gallery - Ayodhya Hotel Photos
      </h2>
      <p class="text-lg text-gray-600">Explore the beauty and serenity of <strong>Sri Janaki Mahal Trust</strong> in <strong>Ayodhya</strong>. See our rooms, courtyard, and <strong>hotel accommodation near Ram Mandir</strong>.</p>
    </div>

    <!-- Dual-lane gallery: manual scroll + auto-scroll in opposite directions -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {galleryGroups.map((group, groupIndex) => (
        <div class="relative h-72 sm:h-96 rounded-lg">
          <div
            class="lane no-scrollbar gallery-scroll overflow-x-auto overflow-y-hidden h-72 sm:h-96 px-4"
            data-direction={group.direction}
            data-duration={AUTO_DURATION_SEC}
            aria-label={`Auto-scrolling gallery lane ${group.direction}`}
          >
            <div class="lane-track flex gap-4 pr-4" style="will-change: scroll-position;">
              { [...group.images, ...group.images].map((image, imageIndex) => (
                <figure
                  class="gallery-item flex-shrink-0 w-[85vw] max-w-sm sm:w-80 sm:max-w-none h-72 sm:h-96 rounded-lg overflow-hidden shadow-lg bg-white"
                  data-index={`${groupIndex}-${imageIndex}`}
                >
                  <img
                    src={image.src}
                    alt={image.alt}
                    title={image.title}
                    loading="lazy"
                    decoding="async"
                    width={image.width}
                    height={image.height}
                    sizes="(max-width: 768px) 85vw, 20rem"
                    class="w-full h-full object-cover transition-transform duration-300 hover:scale-110"
                  />
                  <figcaption class="sr-only">{image.caption}</figcaption>
                </figure>
              )) }
            </div>
          </div>
        </div>
      )) }
    </div>
  </div>
</section>

<script type="application/ld+json" set:html={JSON.stringify(imageSchemas, null, 2)} />

<script type="module">
  // Seamless loop via scrollLeft with wrap-around.
  // - Drag-to-scroll and wheel-to-horizontal pause auto.
  // - Scroll-snap active only during user interaction.
  // - Auto-scroll runs only when in viewport (mobile INP-friendly).
  // - Respects prefers-reduced-motion and data-saver mode.
  (function () {
    try {
      const lanes = Array.from(document.querySelectorAll('.lane'));
      if (!lanes.length) return;

      const prefersReducedMotion =
        typeof window.matchMedia === 'function' && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const saveData = Boolean(navigator && navigator.connection && navigator.connection.saveData);
      const canAutoScroll = !prefersReducedMotion && !saveData;

      lanes.forEach((lane) => {
        const track = lane.querySelector('.lane-track');
        if (!track) return;

        let dragging = false;
        let startX = 0;
        let startScrollLeft = 0;
        let isPaused = false;
        let last = performance.now();
        let halfWidth = 0; // width of one set of items (we duplicated arrays)
        const hasIntersectionObserver = typeof IntersectionObserver === 'function';
        let isInView = !hasIntersectionObserver;
        let isPageVisible = !document.hidden;
        let running = false;
        let rafId = 0;

        const recalc = () => {
          // half of total scrollWidth because items are duplicated
          halfWidth = Math.floor(track.scrollWidth / 2);
          if (!halfWidth) halfWidth = 1;
          // Initialize scrollLeft position for rightward lanes to end
          if ((lane.getAttribute('data-direction') || 'left') === 'right' && lane.scrollLeft === 0) {
            lane.scrollLeft = halfWidth;
          }
        };

        const pause = () => { isPaused = true; lane.classList.add('snap-active'); };
        const resume = () => { isPaused = false; lane.classList.remove('snap-active'); last = performance.now(); };

        // Don't pause on mere hover to avoid jitter; only during active interactions

        lane.addEventListener('pointerdown', (e) => {
          dragging = true;
          try { lane.setPointerCapture(e.pointerId); } catch {}
          startX = e.clientX;
          startScrollLeft = lane.scrollLeft;
          pause();
        });
        lane.addEventListener('pointermove', (e) => {
          if (!dragging) return;
          lane.scrollLeft = startScrollLeft - (e.clientX - startX);
        });
        lane.addEventListener('pointerup', () => { dragging = false; resume(); });
        lane.addEventListener('pointercancel', () => { dragging = false; resume(); });

        lane.addEventListener('wheel', (e) => {
          if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
            e.preventDefault();
            lane.scrollLeft += e.deltaY;
          }
          pause();
          clearTimeout((lane)._wheelResumeTimer);
          (lane)._wheelResumeTimer = setTimeout(resume, 150);
        }, { passive: false });

        const speed = () => {
          const dur = Number(lane.getAttribute('data-duration') || 15);
          return halfWidth / Math.max(1, dur); // px/sec
        };

        const shouldRun = () => canAutoScroll && isInView && isPageVisible;

        const stop = () => {
          if (!running) return;
          running = false;
          if (rafId) cancelAnimationFrame(rafId);
          rafId = 0;
        };

        const start = () => {
          if (running) return;
          if (!shouldRun()) return;
          running = true;
          last = performance.now();
          rafId = requestAnimationFrame(step);
        };

        const step = (now) => {
          if (!lane.isConnected) {
            stop();
            return;
          }
          if (!running) return;
          if (!shouldRun()) {
            stop();
            return;
          }

          const dt = (now - last) / 1000;
          last = now;
          if (!isPaused && !dragging) {
            const dir = (lane.getAttribute('data-direction') || 'left');
            const delta = speed() * dt;
            if (dir === 'left') {
              lane.scrollLeft += delta;
              if (lane.scrollLeft >= halfWidth) lane.scrollLeft -= halfWidth;
            } else {
              lane.scrollLeft -= delta;
              if (lane.scrollLeft <= 0) lane.scrollLeft += halfWidth;
            }
          }
          rafId = requestAnimationFrame(step);
        };

        // Initial measurements after images load
        const imgs = Array.from(track.querySelectorAll('img'));
        let pending = imgs.length;
        const done = () => { pending = Math.max(0, pending - 1); if (pending === 0) { recalc(); } };
        imgs.forEach((im) => { if (im.complete) done(); else im.addEventListener('load', done, { once: true }); });
        recalc();

        if (hasIntersectionObserver) {
          const observer = new IntersectionObserver(
            (entries) => {
              const entry = entries && entries[0];
              isInView = Boolean(entry && entry.isIntersecting);
              if (isInView) start();
              else stop();
            },
            { root: null, threshold: 0.2 }
          );
          observer.observe(lane);
        }

        document.addEventListener('visibilitychange', () => {
          isPageVisible = !document.hidden;
          if (isPageVisible) start();
          else stop();
        });

        // Start only when we can and when visible/in-view.
        start();
      });
    } catch {}
  })();
</script>
