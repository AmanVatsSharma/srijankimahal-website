<!-- // src/layouts/Layout.astro -->
---
import '../styles/global.css';
import { generateSEOData, type SEOConfig } from '../lib/seo';
import { SCHEMA_TELEPHONE, WHATSAPP_LINK, OFFICIAL_EMAIL, GOOGLE_MAPS_GBP_URL } from '../lib/constants';

// SEO Props Interface
interface Props {
  title?: string;
  titleMaxLength?: number;
  description?: string;
  keywords?: string[];
  canonical?: string;
  ogImage?: string;
  ogType?: 'website' | 'article';
  noindex?: boolean;
  lang?: 'en' | 'hi';
  alternateLanguages?: { lang: string; url: string }[];
  disableDefaultHreflangPair?: boolean;
}

// Get SEO props with defaults
const {
  title = 'Sri Janaki Mahal Trust - Best Hotel in Ayodhya | Online Room Booking',
  titleMaxLength,
  description,
  keywords,
  canonical,
  ogImage,
  ogType,
  noindex = false,
  lang = 'en',
  alternateLanguages,
  disableDefaultHreflangPair = false,
}: Props = Astro.props;

// Get current path for canonical URL generation
const currentPath = Astro.url.pathname;

// Generate complete SEO data
const seoConfig: SEOConfig = {
  title,
  titleMaxLength,
  description,
  keywords,
  canonical,
  ogImage,
  ogType,
  noindex,
  lang,
  alternateLanguages,
  disableDefaultHreflangPair,
};

const seoData = generateSEOData(seoConfig, currentPath);
const googleSiteVerification = import.meta.env.PUBLIC_GOOGLE_SITE_VERIFICATION;
const googleAdsConversionLabel = import.meta.env.PUBLIC_GOOGLE_ADS_CONVERSION_LABEL;
const googleMapsListingUrl = GOOGLE_MAPS_GBP_URL;
const currentOgLocale = seoData.ogTags['og:locale'];
const ogImageUrl = seoData.ogTags['og:image'];
const isDefaultOgImage = typeof ogImageUrl === 'string' && ogImageUrl.endsWith('/og.jpg');
const ogImageAlt = `${seoData.title} - Sri Janaki Mahal Trust`;
const ogLocaleAlternates = Array.from(
  new Set(
    seoData.hreflangTags
      .map(({ hreflang }) => {
        if (hreflang === 'en') return 'en_IN';
        if (hreflang === 'hi') return 'hi_IN';
        return null;
      })
      .filter((locale): locale is string => Boolean(locale) && locale !== currentOgLocale)
  )
);

/**
 * Global structured data is prepared in frontmatter so constants are safely interpolated.
 * This avoids invalid JSON-LD tokens in generated HTML.
 */
const globalStructuredData = {
  '@context': 'https://schema.org',
  '@graph': [
    {
      '@type': 'WebSite',
      '@id': 'https://www.srijanakimahaltrustofficial.com/#website',
      url: 'https://www.srijanakimahaltrustofficial.com/',
      name: 'Sri Janaki Mahal Trust',
      description: 'Best hotel in Ayodhya offering comfortable accommodation near Ram Mandir with online room booking',
      potentialAction: {
        '@type': 'SearchAction',
        target: 'https://www.srijanakimahaltrustofficial.com/?s={search_term_string}',
        'query-input': 'required name=search_term_string',
      },
    },
    {
      '@type': 'Organization',
      '@id': 'https://www.srijanakimahaltrustofficial.com/#organization',
      name: 'Sri Janaki Mahal Trust',
      alternateName: [
        'Janaki Mahal Trust',
        'Janaki Mahal',
        'Janaki Mahal Ayodhya',
        'Janaki Mahal Booking',
        'Janaki Mahal Official',
        'Janaki Mahal Trust Ayodhya',
        'Janaki Trust Ayodhya',
        'Janaki Mandir Trust',
        'Sri Janki Mahal Trust',
        'Sri Janaki Mahal',
        'Sri Janki Mahal',
        'Ram Janki Mahal',
        'Ram Janki Mahal Ayodhya',
        'Ram Janki Mahal Trust',
        'Sri Janaki Mahal Trust Booking',
        'Shri Janki Mahal Trust',
        'Shri Janaki Mahal Trust',
        'Shri Janaki Mahal',
        'Shri Janki Mahal',
        'Shree Janaki Mahal Trust',
        'Shree Janki Mahal Trust',
        'Shree Janaki Mahal',
        'Shree Janki Mahal',
        'Janki Mahal Trust',
        'Janki Mahal',
        'Janki Mahal Ayodhya',
        'Janki Mahal Booking',
        'Janki Mahal Trust Ayodhya',
        'Janki Trust Ayodhya',
        'Janki Mandir Trust',
        'Janaki Hotel Ayodhya',
        'Janaki Guest House Ayodhya',
        'Sri Janaki Guest House',
        'Sri Janaki Hotel',
        'Janaki Trust Booking Number',
        'Janaki Trust Official Number',
      ],
      url: 'https://www.srijanakimahaltrustofficial.com/',
      logo: {
        '@type': 'ImageObject',
        url: 'https://www.srijanakimahaltrustofficial.com/favicon.svg',
      },
      contactPoint: {
        '@type': 'ContactPoint',
        telephone: SCHEMA_TELEPHONE,
        contactType: 'customer service',
        availableLanguage: ['English', 'Hindi'],
        areaServed: 'IN',
        hoursAvailable: [
          {
            '@type': 'OpeningHoursSpecification',
            dayOfWeek: [
              'Monday',
              'Tuesday',
              'Wednesday',
              'Thursday',
              'Friday',
              'Saturday',
              'Sunday',
            ],
            opens: '00:00',
            closes: '23:59',
          },
        ],
      },
      email: OFFICIAL_EMAIL,
      address: {
        '@type': 'PostalAddress',
        streetAddress: 'Vasudev Gath, Karsewakpuram',
        addressLocality: 'Ayodhya',
        addressRegion: 'Uttar Pradesh',
        postalCode: '224123',
        addressCountry: 'IN',
      },
      foundingDate: '2020',
      legalName: 'Sri Janaki Mahal Trust',
      description: 'Registered charitable trust providing comfortable hotel accommodation in Ayodhya near Ram Mandir',
      sameAs: [WHATSAPP_LINK, googleMapsListingUrl],
    },
    {
      '@type': 'LocalBusiness',
      '@id': 'https://www.srijanakimahaltrustofficial.com/#localbusiness',
      name: 'Sri Janaki Mahal Trust',
      alternateName: [
        'Janaki Mahal Trust',
        'Sri Janki Mahal Trust',
        'Shri Janki Mahal Trust',
        'Janki Mahal Trust Ayodhya',
        'Shri Janaki Mahal Trust',
        'Janaki Mahal',
        'Sri Janki Mahal',
        'Ram Janki Mahal',
        'Ram Janki Mahal Trust',
      ],
      image: 'https://www.srijanakimahaltrustofficial.com/og.jpg',
      telephone: SCHEMA_TELEPHONE,
      email: OFFICIAL_EMAIL,
      url: 'https://www.srijanakimahaltrustofficial.com/',
      address: {
        '@type': 'PostalAddress',
        streetAddress: 'Vasudev Gath, Karsewakpuram',
        addressLocality: 'Ayodhya',
        addressRegion: 'Uttar Pradesh',
        postalCode: '224123',
        addressCountry: 'IN',
      },
      geo: {
        '@type': 'GeoCoordinates',
        latitude: 26.8039286,
        longitude: 82.2109433,
      },
      areaServed: 'IN',
      openingHours: 'Mo-Su 00:00-23:59',
      priceRange: '₹1,250 - ₹4,150',
      description: 'Best hotel in Ayodhya offering comfortable accommodation near Ram Mandir with all meals included and online booking',
    },
    {
      '@type': 'LodgingBusiness',
      '@id': 'https://www.srijanakimahaltrustofficial.com/#lodgingbusiness',
      name: 'Sri Janaki Mahal Trust',
      alternateName: [
        'Janaki Mahal Trust',
        'Sri Janki Mahal Trust',
        'Shri Janki Mahal Trust',
        'Janki Mahal Trust Ayodhya',
        'Shri Janaki Mahal Trust',
        'Janaki Mahal',
        'Sri Janki Mahal',
        'Ram Janki Mahal',
        'Ram Janki Mahal Trust',
      ],
      image: 'https://www.srijanakimahaltrustofficial.com/og.jpg',
      telephone: SCHEMA_TELEPHONE,
      email: OFFICIAL_EMAIL,
      url: 'https://www.srijanakimahaltrustofficial.com/',
      address: {
        '@type': 'PostalAddress',
        streetAddress: 'Vasudev Gath, Karsewakpuram',
        addressLocality: 'Ayodhya',
        addressRegion: 'Uttar Pradesh',
        postalCode: '224123',
        addressCountry: 'IN',
      },
      geo: {
        '@type': 'GeoCoordinates',
        latitude: 26.8039286,
        longitude: 82.2109433,
      },
      checkinTime: '14:00',
      checkoutTime: '12:00',
      priceRange: '₹1,250 - ₹4,150',
      makesOffer: [
        {
          '@type': 'Offer',
          name: '2 Bed Non-AC Room',
          url: 'https://www.srijanakimahaltrustofficial.com/rooms/2-bed-non-ac',
          priceCurrency: 'INR',
          price: '1250',
        },
        {
          '@type': 'Offer',
          name: '2 Bed AC Room',
          url: 'https://www.srijanakimahaltrustofficial.com/rooms/2-bed-ac',
          priceCurrency: 'INR',
          price: '1750',
        },
        {
          '@type': 'Offer',
          name: '3 Bed Non-AC Room',
          url: 'https://www.srijanakimahaltrustofficial.com/rooms/3-bed-non-ac',
          priceCurrency: 'INR',
          price: '1950',
        },
        {
          '@type': 'Offer',
          name: '3 Bed AC Room',
          url: 'https://www.srijanakimahaltrustofficial.com/rooms/3-bed-ac',
          priceCurrency: 'INR',
          price: '2550',
        },
        {
          '@type': 'Offer',
          name: '4 Bed Non-AC Room',
          url: 'https://www.srijanakimahaltrustofficial.com/rooms/4-bed-non-ac',
          priceCurrency: 'INR',
          price: '2650',
        },
        {
          '@type': 'Offer',
          name: '4 Bed AC Room',
          url: 'https://www.srijanakimahaltrustofficial.com/rooms/4-bed-ac',
          priceCurrency: 'INR',
          price: '3100',
        },
        {
          '@type': 'Offer',
          name: 'Deluxe Room',
          url: 'https://www.srijanakimahaltrustofficial.com/rooms/deluxe-room',
          priceCurrency: 'INR',
          price: '3200',
        },
        {
          '@type': 'Offer',
          name: 'Family Suite',
          url: 'https://www.srijanakimahaltrustofficial.com/rooms/family-suite',
          priceCurrency: 'INR',
          price: '3650',
        },
      ],
      amenityFeature: [
        {
          '@type': 'LocationFeatureSpecification',
          name: 'All Meals Included',
          value: true,
        },
        {
          '@type': 'LocationFeatureSpecification',
          name: '24/7 Customer Support',
          value: true,
        },
        {
          '@type': 'LocationFeatureSpecification',
          name: 'Hot Water',
          value: true,
        },
        {
          '@type': 'LocationFeatureSpecification',
          name: 'Peaceful Environment',
          value: true,
        },
        {
          '@type': 'LocationFeatureSpecification',
          name: 'Near Ram Mandir',
          value: true,
        },
      ],
    },
  ],
};
---

<!doctype html>
<html lang={seoData.lang}>
  <head>
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://www.google-analytics.com" />
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />
    <link rel="preconnect" href="https://www.google-analytics.com" crossorigin />
    <!-- Note: keep image preloads page-scoped via the `head` slot to avoid wasting bandwidth on non-hero pages. -->

    <!-- Google tag (gtag.js) -->
    <script>
      try {
        (function () {
          var loaded = false;
          function loadGtag() {
            if (loaded) return;
            loaded = true;
            var s = document.createElement('script');
            s.async = true;
            s.src = 'https://www.googletagmanager.com/gtag/js?id=AW-17922029438';
            document.head.appendChild(s);
          }

          if (typeof window.requestIdleCallback === 'function') {
            window.requestIdleCallback(loadGtag, { timeout: 2000 });
          } else {
            window.addEventListener('load', loadGtag, { once: true });
          }
        })();
      } catch {
        // no-op
      }
    </script>
    <script>
      // @ts-ignore - Google Analytics global variables
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      // @ts-ignore
      window.gtag = gtag;
      gtag('js', new Date());

      gtag('config', 'AW-17922029438');
    </script>

    <!-- Event snippet for Click to call conversion page -->
    <script define:vars={{ googleAdsConversionLabel }}>
      // Click conversion helper
      // - Always return `true` so navigation (tel/wa) is never blocked.
      // - Attach to `window` so inline `onclick="return gtag_report_conversion(...)"` can call it.
      try {
        // @ts-ignore
        window.gtag_report_conversion = function gtag_report_conversion(url) {
          try {
            if (!googleAdsConversionLabel || typeof window.gtag !== 'function') {
              return true;
            }

            // @ts-ignore - Google Analytics global function
            window.gtag('event', 'conversion', {
              'send_to': 'AW-17922029438/' + googleAdsConversionLabel,
              'value': 1.0,
              'currency': 'INR',
              'event_callback': function () {},
            });
          } catch {
            // no-op
          }
          return true;
        };
      } catch {
        // no-op
      }
    </script>
    
    <meta charset="UTF-8" />
    <meta name="description" content={seoData.description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#d4a574" />
    <meta name="robots" content={seoData.robots} />
    {seoData.keywords && <meta name="keywords" content={seoData.keywords} />}
    
    <!-- Security Meta Tags -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <meta name="format-detection" content="telephone=no" />
    
    <!-- Google Site Verification (configured via PUBLIC_GOOGLE_SITE_VERIFICATION) -->
    {googleSiteVerification && (
      <meta name="google-site-verification" content={googleSiteVerification} />
    )}
    
    <!-- Google Ads Disclosure -->
    <meta name="google-ads-disclosure" content="This site uses Google Ads for advertising purposes" />
    
    <!-- Canonical URL -->
    <link rel="canonical" href={seoData.canonical} />
    
    <!-- Hreflang Tags for Multilingual Support -->
    {seoData.hreflangTags.map((tag) => (
      <link rel={tag.rel} hreflang={tag.hreflang} href={tag.href} />
    ))}

    <slot name="head" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={seoData.ogTags['og:type']} />
    <meta property="og:url" content={seoData.ogTags['og:url']} />
    <meta property="og:title" content={seoData.ogTags['og:title']} />
    <meta property="og:description" content={seoData.ogTags['og:description']} />
    <meta property="og:image" content={seoData.ogTags['og:image']} />
    <meta property="og:image:alt" content={ogImageAlt} />
    {isDefaultOgImage && (
      <>
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="630" />
        <meta property="og:image:type" content="image/jpeg" />
      </>
    )}
    <meta property="og:site_name" content={seoData.ogTags['og:site_name']} />
    <meta property="og:locale" content={seoData.ogTags['og:locale']} />
    {ogLocaleAlternates.map((locale) => (
      <meta property="og:locale:alternate" content={locale} />
    ))}
    
    <!-- Twitter -->
    <meta property="twitter:card" content={seoData.twitterTags['twitter:card']} />
    <meta property="twitter:url" content={seoData.twitterTags['twitter:url']} />
    <meta property="twitter:title" content={seoData.twitterTags['twitter:title']} />
    <meta property="twitter:description" content={seoData.twitterTags['twitter:description']} />
    <meta property="twitter:image" content={seoData.twitterTags['twitter:image']} />
    <meta property="twitter:image:alt" content={ogImageAlt} />
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{seoData.title}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(globalStructuredData)} />
  </head>
  <body class="bg-[#faf8f3]">
    <slot />
  </body>
</html>
