<!-- // src/layouts/Layout.astro -->
---
import '../styles/global.css';
import { generateSEOData, type SEOConfig } from '../lib/seo';

// SEO Props Interface
interface Props {
  title?: string;
  description?: string;
  keywords?: string[];
  canonical?: string;
  ogImage?: string;
  ogType?: 'website' | 'article';
  noindex?: boolean;
  lang?: 'en' | 'hi';
  alternateLanguages?: { lang: string; url: string }[];
}

// Get SEO props with defaults
const {
  title = 'Sri Janaki Mahal - Spiritual Dharmshala in Ayodhya',
  description,
  keywords,
  canonical,
  ogImage,
  ogType,
  noindex = false,
  lang = 'en',
  alternateLanguages,
}: Props = Astro.props;

// Get current path for canonical URL generation
const currentPath = Astro.url.pathname;

// Generate complete SEO data
const seoConfig: SEOConfig = {
  title,
  description,
  keywords,
  canonical,
  ogImage,
  ogType,
  noindex,
  lang,
  alternateLanguages,
};

const seoData = generateSEOData(seoConfig, currentPath);

console.log('[Layout] SEO data generated:', {
  title: seoData.title,
  path: currentPath,
  lang: seoData.lang,
});
---

<!doctype html>
<html lang={seoData.lang}>
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17664529026"></script>
    <script>
      // @ts-ignore - Google Analytics global variables
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'AW-17664529026');
    </script>
    
    <!-- Event snippet for Click to call conversion page -->
    <script>
    // @ts-ignore - Google Analytics conversion tracking
    function gtag_report_conversion(url) {
      var callback = function () {
        if (typeof(url) != 'undefined') {
          window.location = url;
        }
      };
      // @ts-ignore - Google Analytics global function
      gtag('event', 'conversion', {
          'send_to': 'AW-17664529026/Zkz9CLjxg7AbELP8qedB',
          'value': 1.0,
          'currency': 'INR',
          'event_callback': callback
      });
      return false;
    }
    </script>
    
    <meta charset="UTF-8" />
    <meta name="description" content={seoData.description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#d4a574" />
    <meta name="robots" content={seoData.robots} />
    {seoData.keywords && <meta name="keywords" content={seoData.keywords} />}
    
    <!-- Security Meta Tags -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <meta name="format-detection" content="telephone=no" />
    
    <!-- Google Site Verification (Replace with actual verification code) -->
    <meta name="google-site-verification" content="your-google-verification-code" />
    
    <!-- Google Ads Disclosure -->
    <meta name="google-ads-disclosure" content="This site uses Google Ads for advertising purposes" />
    
    <!-- Canonical URL -->
    <link rel="canonical" href={seoData.canonical} />
    
    <!-- Hreflang Tags for Multilingual Support -->
    {seoData.hreflangTags.map((tag) => (
      <link rel={tag.rel} hreflang={tag.hreflang} href={tag.href} />
    ))}
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={seoData.ogTags['og:type']} />
    <meta property="og:url" content={seoData.ogTags['og:url']} />
    <meta property="og:title" content={seoData.ogTags['og:title']} />
    <meta property="og:description" content={seoData.ogTags['og:description']} />
    <meta property="og:image" content={seoData.ogTags['og:image']} />
    <meta property="og:site_name" content={seoData.ogTags['og:site_name']} />
    <meta property="og:locale" content={seoData.ogTags['og:locale']} />
    
    <!-- Twitter -->
    <meta property="twitter:card" content={seoData.twitterTags['twitter:card']} />
    <meta property="twitter:url" content={seoData.twitterTags['twitter:url']} />
    <meta property="twitter:title" content={seoData.twitterTags['twitter:title']} />
    <meta property="twitter:description" content={seoData.twitterTags['twitter:description']} />
    <meta property="twitter:image" content={seoData.twitterTags['twitter:image']} />
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{seoData.title}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "WebSite",
          "@id": "https://srijanakimahaltrust.in/#website",
          "url": "https://srijanakimahaltrust.in/",
          "name": "Sri Janaki Mahal Trust",
          "description": "Spiritual Dharmshala in Ayodhya offering comfortable accommodation near Ram Mandir",
          "potentialAction": {
            "@type": "SearchAction",
            "target": "https://srijanakimahaltrust.in/?s={search_term_string}",
            "query-input": "required name=search_term_string"
          }
        },
        {
          "@type": "Organization",
          "@id": "https://srijanakimahaltrust.in/#organization",
          "name": "Sri Janaki Mahal Trust",
          "url": "https://srijanakimahaltrust.in/",
          "logo": {
            "@type": "ImageObject",
            "url": "https://srijanakimahaltrust.in/favicon.svg"
          },
          "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "+91-7250364323",
            "contactType": "customer service",
            "availableLanguage": ["English", "Hindi"],
            "areaServed": "IN",
            "hoursAvailable": "24/7"
          },
          "email": "srijanakimahaltrust7484@gmail.com",
          "address": {
            "@type": "PostalAddress",
            "streetAddress": "Vasudev Gath, Karsewakpuram",
            "addressLocality": "Ayodhya",
            "addressRegion": "Uttar Pradesh",
            "postalCode": "224123",
            "addressCountry": "IN"
          },
          "foundingDate": "2020",
          "legalName": "Sri Janaki Mahal Trust",
          "description": "Registered charitable trust providing spiritual accommodation in Ayodhya",
          "sameAs": [
            "https://wa.me/917250364323"
          ]
        },
        {
          "@type": "LocalBusiness",
          "@id": "https://srijanakimahaltrust.in/#localbusiness",
          "name": "Sri Janaki Mahal Trust",
          "image": "https://srijanakimahaltrust.in/og.jpg",
          "telephone": "+91-7250364323",
          "email": "srijanakimahaltrust7484@gmail.com",
          "url": "https://srijanakimahaltrust.in/",
          "address": {
            "@type": "PostalAddress",
            "streetAddress": "Vasudev Gath, Karsewakpuram",
            "addressLocality": "Ayodhya",
            "addressRegion": "Uttar Pradesh",
            "postalCode": "224123",
            "addressCountry": "IN"
          },
          "geo": {
            "@type": "GeoCoordinates",
            "latitude": 26.8039286,
            "longitude": 82.2109433
          },
          "openingHours": "Mo-Su 00:00-23:59",
          "priceRange": "₹₹",
          "description": "Spiritual Dharmshala in Ayodhya offering comfortable accommodation near Ram Mandir with all meals included"
        },
        {
          "@type": "LodgingBusiness",
          "@id": "https://srijanakimahaltrust.in/#lodgingbusiness",
          "name": "Sri Janaki Mahal Trust",
          "image": "https://srijanakimahaltrust.in/og.jpg",
          "telephone": "+91-7250364323",
          "email": "srijanakimahaltrust7484@gmail.com",
          "url": "https://srijanakimahaltrust.in/",
          "address": {
            "@type": "PostalAddress",
            "streetAddress": "Vasudev Gath, Karsewakpuram",
            "addressLocality": "Ayodhya",
            "addressRegion": "Uttar Pradesh",
            "postalCode": "224123",
            "addressCountry": "IN"
          },
          "geo": {
            "@type": "GeoCoordinates",
            "latitude": 26.8039286,
            "longitude": 82.2109433
          },
          "checkinTime": "14:00",
          "checkoutTime": "12:00",
          "priceRange": "₹1,250 - ₹4,150",
          "amenityFeature": [
            {
              "@type": "LocationFeatureSpecification",
              "name": "All Meals Included",
              "value": true
            },
            {
              "@type": "LocationFeatureSpecification", 
              "name": "24/7 Customer Support",
              "value": true
            },
            {
              "@type": "LocationFeatureSpecification",
              "name": "Hot Water",
              "value": true
            },
            {
              "@type": "LocationFeatureSpecification",
              "name": "Spiritual Environment",
              "value": true
            },
            {
              "@type": "LocationFeatureSpecification",
              "name": "Near Ram Mandir",
              "value": true
            }
          ],
          "starRating": {
            "@type": "Rating",
            "ratingValue": "4.5"
          }
        }
      ]
    }
    </script>
  </head>
  <body class="bg-[#faf8f3]">
    <slot />
    <script>
      // Global image load error logger
      window.addEventListener('error', (event) => {
        const target = event.target;
        if (target && target.tagName === 'IMG') {
          console.error('[Image Load Error]', target.src);
        }
      }, true);
    </script>
  </body>
</html>
