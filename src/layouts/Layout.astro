<!-- // src/layouts/Layout.astro -->
---
import '../styles/global.css';
import { generateSEOData, type SEOConfig } from '../lib/seo';
import { SCHEMA_TELEPHONE, WHATSAPP_LINK, OFFICIAL_EMAIL } from '../lib/constants';

// SEO Props Interface
interface Props {
  title?: string;
  description?: string;
  keywords?: string[];
  canonical?: string;
  ogImage?: string;
  ogType?: 'website' | 'article';
  noindex?: boolean;
  lang?: 'en' | 'hi';
  alternateLanguages?: { lang: string; url: string }[];
  disableDefaultHreflangPair?: boolean;
}

// Get SEO props with defaults
const {
  title = 'Sri Janaki Mahal Trust - Best Hotel in Ayodhya | Online Room Booking',
  description,
  keywords,
  canonical,
  ogImage,
  ogType,
  noindex = false,
  lang = 'en',
  alternateLanguages,
  disableDefaultHreflangPair = false,
}: Props = Astro.props;

// Get current path for canonical URL generation
const currentPath = Astro.url.pathname;

// Generate complete SEO data
const seoConfig: SEOConfig = {
  title,
  description,
  keywords,
  canonical,
  ogImage,
  ogType,
  noindex,
  lang,
  alternateLanguages,
  disableDefaultHreflangPair,
};

const seoData = generateSEOData(seoConfig, currentPath);
const googleSiteVerification = import.meta.env.PUBLIC_GOOGLE_SITE_VERIFICATION;
const googleAdsConversionLabel = import.meta.env.PUBLIC_GOOGLE_ADS_CONVERSION_LABEL;

/**
 * Global structured data is prepared in frontmatter so constants are safely interpolated.
 * This avoids invalid JSON-LD tokens in generated HTML.
 */
const globalStructuredData = {
  '@context': 'https://schema.org',
  '@graph': [
    {
      '@type': 'WebSite',
      '@id': 'https://www.srijanakimahaltrustofficial.com/#website',
      url: 'https://www.srijanakimahaltrustofficial.com/',
      name: 'Sri Janaki Mahal Trust',
      description: 'Best hotel in Ayodhya offering comfortable accommodation near Ram Mandir with online room booking',
      potentialAction: {
        '@type': 'SearchAction',
        target: 'https://www.srijanakimahaltrustofficial.com/?s={search_term_string}',
        'query-input': 'required name=search_term_string',
      },
    },
    {
      '@type': 'Organization',
      '@id': 'https://www.srijanakimahaltrustofficial.com/#organization',
      name: 'Sri Janaki Mahal Trust',
      alternateName: [
        'Janaki Mahal Trust',
        'Janaki Mahal',
        'Janaki Mahal Ayodhya',
        'Janaki Mahal Booking',
        'Janaki Mahal Official',
        'Janaki Mahal Trust Ayodhya',
        'Janaki Trust Ayodhya',
        'Janaki Mandir Trust',
        'Sri Janki Mahal Trust',
        'Sri Janaki Mahal',
        'Sri Janki Mahal',
        'Sri Janaki Mahal Trust Booking',
        'Shri Janki Mahal Trust',
        'Shri Janaki Mahal Trust',
        'Shri Janaki Mahal',
        'Shri Janki Mahal',
        'Shree Janaki Mahal Trust',
        'Shree Janki Mahal Trust',
        'Shree Janaki Mahal',
        'Shree Janki Mahal',
        'Janki Mahal Trust',
        'Janki Mahal',
        'Janki Mahal Ayodhya',
        'Janki Mahal Booking',
        'Janki Mahal Trust Ayodhya',
        'Janki Trust Ayodhya',
        'Janki Mandir Trust',
        'Janaki Hotel Ayodhya',
        'Janaki Guest House Ayodhya',
        'Sri Janaki Guest House',
        'Sri Janaki Hotel',
        'Janaki Trust Booking Number',
        'Janaki Trust Official Number',
      ],
      url: 'https://www.srijanakimahaltrustofficial.com/',
      logo: {
        '@type': 'ImageObject',
        url: 'https://www.srijanakimahaltrustofficial.com/favicon.svg',
      },
      contactPoint: {
        '@type': 'ContactPoint',
        telephone: SCHEMA_TELEPHONE,
        contactType: 'customer service',
        availableLanguage: ['English', 'Hindi'],
        areaServed: 'Ayodhya, Uttar Pradesh, India',
        hoursAvailable: '24/7',
      },
      email: OFFICIAL_EMAIL,
      address: {
        '@type': 'PostalAddress',
        streetAddress: 'Vasudev Gath, Karsewakpuram',
        addressLocality: 'Ayodhya',
        addressRegion: 'Uttar Pradesh',
        postalCode: '224123',
        addressCountry: 'IN',
      },
      foundingDate: '2020',
      legalName: 'Sri Janaki Mahal Trust',
      description: 'Registered charitable trust providing comfortable hotel accommodation in Ayodhya near Ram Mandir',
      sameAs: [WHATSAPP_LINK],
    },
    {
      '@type': 'LocalBusiness',
      '@id': 'https://www.srijanakimahaltrustofficial.com/#localbusiness',
      name: 'Sri Janaki Mahal Trust',
      alternateName: [
        'Janaki Mahal Trust',
        'Sri Janki Mahal Trust',
        'Shri Janki Mahal Trust',
        'Janki Mahal Trust Ayodhya',
        'Shri Janaki Mahal Trust',
        'Janaki Mahal',
        'Sri Janki Mahal',
      ],
      image: 'https://www.srijanakimahaltrustofficial.com/og.jpg',
      telephone: SCHEMA_TELEPHONE,
      email: OFFICIAL_EMAIL,
      url: 'https://www.srijanakimahaltrustofficial.com/',
      address: {
        '@type': 'PostalAddress',
        streetAddress: 'Vasudev Gath, Karsewakpuram',
        addressLocality: 'Ayodhya',
        addressRegion: 'Uttar Pradesh',
        postalCode: '224123',
        addressCountry: 'IN',
      },
      geo: {
        '@type': 'GeoCoordinates',
        latitude: 26.8039286,
        longitude: 82.2109433,
      },
      areaServed: 'Ayodhya, Uttar Pradesh, India',
      openingHours: 'Mo-Su 00:00-23:59',
      priceRange: '₹1,250 - ₹4,150',
      description: 'Best hotel in Ayodhya offering comfortable accommodation near Ram Mandir with all meals included and online booking',
    },
    {
      '@type': 'LodgingBusiness',
      '@id': 'https://www.srijanakimahaltrustofficial.com/#lodgingbusiness',
      name: 'Sri Janaki Mahal Trust',
      alternateName: [
        'Janaki Mahal Trust',
        'Sri Janki Mahal Trust',
        'Shri Janki Mahal Trust',
        'Janki Mahal Trust Ayodhya',
        'Shri Janaki Mahal Trust',
        'Janaki Mahal',
        'Sri Janki Mahal',
      ],
      image: 'https://www.srijanakimahaltrustofficial.com/og.jpg',
      telephone: SCHEMA_TELEPHONE,
      email: OFFICIAL_EMAIL,
      url: 'https://www.srijanakimahaltrustofficial.com/',
      address: {
        '@type': 'PostalAddress',
        streetAddress: 'Vasudev Gath, Karsewakpuram',
        addressLocality: 'Ayodhya',
        addressRegion: 'Uttar Pradesh',
        postalCode: '224123',
        addressCountry: 'IN',
      },
      geo: {
        '@type': 'GeoCoordinates',
        latitude: 26.8039286,
        longitude: 82.2109433,
      },
      checkinTime: '14:00',
      checkoutTime: '12:00',
      priceRange: '₹1,250 - ₹4,150',
      amenityFeature: [
        {
          '@type': 'LocationFeatureSpecification',
          name: 'All Meals Included',
          value: true,
        },
        {
          '@type': 'LocationFeatureSpecification',
          name: '24/7 Customer Support',
          value: true,
        },
        {
          '@type': 'LocationFeatureSpecification',
          name: 'Hot Water',
          value: true,
        },
        {
          '@type': 'LocationFeatureSpecification',
          name: 'Peaceful Environment',
          value: true,
        },
        {
          '@type': 'LocationFeatureSpecification',
          name: 'Near Ram Mandir',
          value: true,
        },
      ],
    },
  ],
};
---

<!doctype html>
<html lang={seoData.lang}>
  <head>
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://www.google-analytics.com" />
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />
    <link rel="preconnect" href="https://www.google-analytics.com" crossorigin />

    <!-- Preload above-the-fold hero image (LCP) -->
    <link rel="preload" as="image" href="/sri-janaki-mahal/IMG-20251017-WA0022.jpg" fetchpriority="high" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17922029438"></script>
    <script>
      // @ts-ignore - Google Analytics global variables
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      // @ts-ignore
      window.gtag = gtag;
      gtag('js', new Date());

      gtag('config', 'AW-17922029438');
    </script>
    
    <!-- Event snippet for Click to call conversion page -->
    <script define:vars={{ googleAdsConversionLabel }}>
      // Click conversion helper
      // - If conversion label isn't configured, do not block navigation.
      // - Keeps `onclick="return gtag_report_conversion(url)"` safe.
      // @ts-ignore
      function gtag_report_conversion(url) {
        try {
          if (!googleAdsConversionLabel || typeof window.gtag !== 'function') {
            return true;
          }

          var callback = function () {
            if (typeof url !== 'undefined') {
              window.location = url;
            }
          };

          // @ts-ignore - Google Analytics global function
          window.gtag('event', 'conversion', {
            'send_to': 'AW-17922029438/' + googleAdsConversionLabel,
            'value': 1.0,
            'currency': 'INR',
            'event_callback': callback
          });
          return false;
        } catch {
          return true;
        }
      }
    </script>
    
    <meta charset="UTF-8" />
    <meta name="description" content={seoData.description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#d4a574" />
    <meta name="robots" content={seoData.robots} />
    {seoData.keywords && <meta name="keywords" content={seoData.keywords} />}
    
    <!-- Security Meta Tags -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <meta name="format-detection" content="telephone=no" />
    
    <!-- Google Site Verification (configured via PUBLIC_GOOGLE_SITE_VERIFICATION) -->
    {googleSiteVerification && (
      <meta name="google-site-verification" content={googleSiteVerification} />
    )}
    
    <!-- Google Ads Disclosure -->
    <meta name="google-ads-disclosure" content="This site uses Google Ads for advertising purposes" />
    
    <!-- Canonical URL -->
    <link rel="canonical" href={seoData.canonical} />
    
    <!-- Hreflang Tags for Multilingual Support -->
    {seoData.hreflangTags.map((tag) => (
      <link rel={tag.rel} hreflang={tag.hreflang} href={tag.href} />
    ))}

    <slot name="head" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={seoData.ogTags['og:type']} />
    <meta property="og:url" content={seoData.ogTags['og:url']} />
    <meta property="og:title" content={seoData.ogTags['og:title']} />
    <meta property="og:description" content={seoData.ogTags['og:description']} />
    <meta property="og:image" content={seoData.ogTags['og:image']} />
    <meta property="og:site_name" content={seoData.ogTags['og:site_name']} />
    <meta property="og:locale" content={seoData.ogTags['og:locale']} />
    
    <!-- Twitter -->
    <meta property="twitter:card" content={seoData.twitterTags['twitter:card']} />
    <meta property="twitter:url" content={seoData.twitterTags['twitter:url']} />
    <meta property="twitter:title" content={seoData.twitterTags['twitter:title']} />
    <meta property="twitter:description" content={seoData.twitterTags['twitter:description']} />
    <meta property="twitter:image" content={seoData.twitterTags['twitter:image']} />
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{seoData.title}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(globalStructuredData)} />
  </head>
  <body class="bg-[#faf8f3]">
    <slot />
  </body>
</html>
