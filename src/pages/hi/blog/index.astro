<!-- // src/pages/hi/blog/index.astro -->
---
import Layout from '../../../layouts/Layout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';
import { getAllBlogPosts, getAllBlogPostsByLang } from '../../../lib/blog';

const allPosts = await getAllBlogPostsByLang('hi');
const englishPosts = await getAllBlogPosts();
const PAGE_SIZE = 12;
const page = 1;
const totalPages = Math.max(1, Math.ceil(allPosts.length / PAGE_SIZE));
const englishTotalPages = Math.max(1, Math.ceil(englishPosts.length / PAGE_SIZE));
const pagePosts = allPosts.slice(0, PAGE_SIZE);
const hasEnglishAlternate = page <= englishTotalPages;
const alternateLanguages = hasEnglishAlternate
  ? [
      { lang: 'en', url: '/blog' },
      { lang: 'hi', url: '/hi/blog' },
    ]
  : [{ lang: 'hi', url: '/hi/blog' }];

const siteUrl = (Astro.site?.toString() ?? 'https://www.srijanakimahaltrustofficial.com').replace(/\/$/, '');
const nextHref = page < totalPages ? `${siteUrl}/hi/blog/page/${page + 1}` : null;

function buildPagination(currentPage: number, total: number): Array<number | 'left-ellipsis' | 'right-ellipsis'> {
  if (total <= 7) {
    return Array.from({ length: total }, (_, index) => index + 1);
  }

  const pages: Array<number | 'left-ellipsis' | 'right-ellipsis'> = [1];
  const leftSibling = Math.max(currentPage - 1, 2);
  const rightSibling = Math.min(currentPage + 1, total - 1);

  if (leftSibling > 2) {
    pages.push('left-ellipsis');
  }

  for (let pageNumber = leftSibling; pageNumber <= rightSibling; pageNumber += 1) {
    pages.push(pageNumber);
  }

  if (rightSibling < total - 1) {
    pages.push('right-ellipsis');
  }

  pages.push(total);
  return pages;
}

const paginationItems = buildPagination(page, totalPages);
---

<Layout
  title="ब्लॉग - श्री जानकी महल ट्रस्ट | अयोध्या गाइड और बुकिंग टिप्स"
  description="अयोध्या यात्रा, राम मंदिर दर्शन, रूम बुकिंग और श्री जानकी महल ट्रस्ट में ठहरने से जुड़े मार्गदर्शक लेख पढ़ें।"
  keywords={[
    'श्री जानकी महल ट्रस्ट ब्लॉग',
    'अयोध्या यात्रा गाइड',
    'राम मंदिर गाइड',
    'रूम बुकिंग टिप्स',
    'सत्यापित बुकिंग',
  ]}
  canonical="/hi/blog"
  ogType="website"
  lang="hi"
  alternateLanguages={alternateLanguages}
  disableDefaultHreflangPair={true}
>
  <Fragment slot="head">
    {nextHref && <link rel="next" href={nextHref} />}
  </Fragment>

  <Header />

  <main class="min-h-screen bg-[#faf8f3] py-12">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h1 class="text-4xl sm:text-5xl font-bold text-gray-900 mb-4">
          श्री जानकी महल ट्रस्ट ब्लॉग
        </h1>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          अयोध्या यात्रा, बुकिंग सत्यापन और ठहरने से जुड़ी जानकारी
        </p>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
        {pagePosts.map((post) => (
          <article class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">
            <a href={`/hi/blog/${post.slug}`} class="block">
              <div class="p-6">
                <div class="flex items-center gap-2 text-sm text-gray-500 mb-3">
                  <time datetime={post.date}>
                    {new Date(post.date).toLocaleDateString('hi-IN', { year: 'numeric', month: 'long', day: 'numeric' })}
                  </time>
                  <span>•</span>
                  <span>{post.readTime}</span>
                </div>
                <h2 class="text-xl font-bold text-gray-900 mb-3 hover:text-amber-600 transition-colors">
                  {post.title}
                </h2>
                <p class="text-gray-600 leading-relaxed mb-4">
                  {post.description}
                </p>
                <span class="text-amber-600 font-semibold hover:text-amber-700">
                  पढ़ें →
                </span>
              </div>
            </a>
          </article>
        ))}
      </div>

      {totalPages > 1 && (
        <nav class="flex flex-wrap items-center justify-center gap-2 mb-12" aria-label="Blog pagination">
          <span
            class="px-4 py-2 rounded-lg bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed"
            aria-disabled="true"
          >
            ← पिछला
          </span>
          {paginationItems.map((item) => {
            if (item === 'left-ellipsis' || item === 'right-ellipsis') {
              return (
                <span class="px-2 text-gray-500" aria-hidden="true">…</span>
              );
            }

            const href = item === 1 ? '/hi/blog' : `/hi/blog/page/${item}`;
            const isCurrent = item === page;

            return (
              <a
                href={href}
                aria-current={isCurrent ? 'page' : undefined}
                class={`px-4 py-2 rounded-lg border transition-colors ${
                  isCurrent
                    ? 'bg-amber-600 text-white font-semibold border-amber-600'
                    : 'bg-white text-gray-900 border-gray-200 hover:border-amber-600 hover:text-amber-700'
                }`}
              >
                {item}
              </a>
            );
          })}
          {nextHref ? (
            <a href={`/hi/blog/page/${page + 1}`} class="px-4 py-2 rounded-lg bg-white text-gray-900 border border-gray-200 hover:border-amber-600 hover:text-amber-700 transition-colors">
              अगला →
            </a>
          ) : (
            <span
              class="px-4 py-2 rounded-lg bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed"
              aria-disabled="true"
            >
              अगला →
            </span>
          )}
        </nav>
      )}
    </div>
  </main>

  <Footer />
</Layout>

