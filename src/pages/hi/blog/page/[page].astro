<!-- // src/pages/hi/blog/page/[page].astro -->
---
import Layout from '../../../../layouts/Layout.astro';
import Header from '../../../../components/Header.astro';
import Footer from '../../../../components/Footer.astro';
import { getAllBlogPostsByLang } from '../../../../lib/blog';

const PAGE_SIZE = 12;

export async function getStaticPaths() {
  const allPosts = await getAllBlogPostsByLang('hi');
  const totalPages = Math.max(1, Math.ceil(allPosts.length / 12));
  const pages = Array.from({ length: Math.max(0, totalPages - 1) }).map((_, i) => i + 2);

  return pages.map((page) => ({
    params: { page: String(page) },
  }));
}

const allPosts = await getAllBlogPostsByLang('hi');
const totalPages = Math.max(1, Math.ceil(allPosts.length / PAGE_SIZE));

const pageParam = Number(Astro.params.page);
if (!Number.isFinite(pageParam) || pageParam < 2 || pageParam > totalPages) {
  throw new Error(`Invalid blog page "${Astro.params.page}"`);
}

const startIndex = (pageParam - 1) * PAGE_SIZE;
const pagePosts = allPosts.slice(startIndex, startIndex + PAGE_SIZE);

const siteUrl = (Astro.site?.toString() ?? 'https://www.srijanakimahaltrustofficial.com').replace(/\/$/, '');
const prevHref = pageParam === 2 ? `${siteUrl}/hi/blog` : `${siteUrl}/hi/blog/page/${pageParam - 1}`;
const nextHref = pageParam < totalPages ? `${siteUrl}/hi/blog/page/${pageParam + 1}` : null;
---

<Layout
  title={`ब्लॉग पेज ${pageParam} - श्री जानकी महल ट्रस्ट`}
  description="अयोध्या यात्रा, राम मंदिर दर्शन और रूम बुकिंग से जुड़े लेख पढ़ें।"
  keywords={[
    'श्री जानकी महल ट्रस्ट ब्लॉग',
    'अयोध्या गाइड',
    'रूम बुकिंग',
    'सत्यापित बुकिंग',
  ]}
  canonical={`/hi/blog/page/${pageParam}`}
  ogType="website"
  lang="hi"
>
  <Fragment slot="head">
    {prevHref && <link rel="prev" href={prevHref} />}
    {nextHref && <link rel="next" href={nextHref} />}
  </Fragment>

  <Header />

  <main class="min-h-screen bg-[#faf8f3] py-12">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h1 class="text-4xl sm:text-5xl font-bold text-gray-900 mb-4">
          श्री जानकी महल ट्रस्ट ब्लॉग
        </h1>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          पेज {pageParam} / {totalPages}
        </p>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
        {pagePosts.map((post) => (
          <article class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">
            <a href={`/hi/blog/${post.slug}`} class="block">
              <div class="p-6">
                <div class="flex items-center gap-2 text-sm text-gray-500 mb-3">
                  <time datetime={post.date}>
                    {new Date(post.date).toLocaleDateString('hi-IN', { year: 'numeric', month: 'long', day: 'numeric' })}
                  </time>
                  <span>•</span>
                  <span>{post.readTime}</span>
                </div>
                <h2 class="text-xl font-bold text-gray-900 mb-3 hover:text-amber-600 transition-colors">
                  {post.title}
                </h2>
                <p class="text-gray-600 leading-relaxed mb-4">{post.description}</p>
                <span class="text-amber-600 font-semibold hover:text-amber-700">पढ़ें →</span>
              </div>
            </a>
          </article>
        ))}
      </div>

      <nav class="flex items-center justify-center gap-3" aria-label="Blog pagination">
        <a
          href={pageParam === 2 ? '/hi/blog' : `/hi/blog/page/${pageParam - 1}`}
          class="px-4 py-2 rounded-lg bg-white text-gray-900 border border-gray-200 hover:border-amber-600 hover:text-amber-700 transition-colors"
        >
          ← Previous
        </a>
        <span class="px-3 py-2 text-sm text-gray-600">
          Page {pageParam} / {totalPages}
        </span>
        {nextHref ? (
          <a
            href={`/hi/blog/page/${pageParam + 1}`}
            class="px-4 py-2 rounded-lg bg-white text-gray-900 border border-gray-200 hover:border-amber-600 hover:text-amber-700 transition-colors"
          >
            Next →
          </a>
        ) : (
          <a
            href="/hi/blog"
            class="px-4 py-2 rounded-lg bg-amber-600 text-white font-semibold hover:bg-amber-700 transition-colors"
          >
            ब्लॉग पर वापस जाएं
          </a>
        )}
      </nav>
    </div>
  </main>

  <Footer />
</Layout>

